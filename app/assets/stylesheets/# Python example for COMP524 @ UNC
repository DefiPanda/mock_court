# Python example for COMP524 @ UNC
# Illustrates ideas discussed in the course
#
# Written by Jeremy Erickson (jerickso@cs.unc.edu)
# 03/27/12
# Adapted by Bryan Ward (bcw@cs.unc.edu)
# 3/26/14

import re
from math import pow

class Car:
    """Base class for cars"""
    manufacturer = "Unknown"
    model = "Unknown"

    def discount(self, employer="None", school="None"):
        if employer == self.manufacturer:
            return "employee"
        elif school != "None":
            return "student"
        else:
            return "none"

    def price(self, discount="none", financing="cash"):
        ret = self.base_price
        for opt in self.options:
            ret += self.option_prices[opt]
        ret *= (1 - self.discount_size[discount])
        m = re.match('(\d+) month', financing)
        if m is not None:
            ret *= pow(1.01, int(m.group(1)))
        elif financing != "cash":
            raise ValueError('Unrecognized financing ' + financing)
        return ret


class CompactA(Car):
    """Compact Car by Company A  - Basic Example"""
    
    manufacturer = "Company A"
    model = "Compact"
    base_price = 5000
    option_prices = {'Heated seats'    : 200,
                     'Sunroof'         : 300,
                     'Satellite radio' : 150}
    discount_size = {'none'     : 0,
                     'employee' : .25,
                     'student'  : .10}

    def __init__(self):
        self.options = []


class CompactB(Car):
    """Compact Car by Company B - Special Discount Structure"""
    manufacturer = "Company B"
    model = "Compact"
    base_price = 4000

    def __init__(self):
        self.options = []
    
    option_prices = {'Antilock brakes'  : 500,
                     'Air conditioning' : 600,
                     'AM/FM radio'      : 100}

    def discount(self, employer="None", school="None"):
        if employer == self.manufacturer:
            return "employee"
        elif re.search("University", school) or re.search("College", school):
            return "university"
        elif re.search("High School", school):
            return "high school"
        else:
            return "none"

    discount_size = {'none'        : 0,
                     'employee'    : .10,
                     'university'  : .075,
                     'high school' : .05}


def PriceFunc(employer, school, financing):
    def _price_func(car):
        discount = car.discount(employer, school)
        return car.price(discount, financing)
    return _price_func